<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: couchlikeChanges.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: couchlikeChanges.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>var EventEmitter = require('events').EventEmitter;
var util = require('util');
var couchbase = require('couchbase');

/**
 * @callback FollowCallback
 * @desc TODO
 * @param {undefined|Error} error - If an error occurred during the operation it is returned here.
 */
/**
 * @callback UnfollowCallback
 * @desc TODO
 * @param {undefined|Error} error - If an error occurred during the operation it is returned here.
 */
/**
 * @desc TODO
 * @event Change
 * @param {Object} change - TODO
 */

/**
 * @classdesc TODO
 * @desc TODO
 * @constructor
 * @augments EventEmitter
 * @param {Couchlike} couchlike - TODO
 * @example
 * TODO
 */
function CouchlikeChanges(couchlike) {
	this.couchlike = couchlike;
}

util.inherits(CouchlikeChanges, EventEmitter);

function nanoFollow(couchlikeChanges, since, callback) {
	var feed = couchlikeChanges.couchlike.engine.bucket.follow({since: since, include_docs: true});
	feed.on('change', function (change) {
		couchlikeChanges.emit('change', change);
	});
	feed.follow();
	if (callback) { callback(null, feed); }
}

function pouchFollow(couchlikeChanges, since, callback) {
	var feed = couchlikeChanges.couchlike.engine.changes({since: since, include_docs: true, live: true});
	feed.on('change', function (change) {
		couchlikeChanges.emit('change', change);
	});
	if (callback) { callback(null, feed); }
}

/**
 * @desc TODO
 * @param {} since
 * @param {FollowCallback} callback
 * @example
 * TODO
 */
CouchlikeChanges.prototype.follow = function(since, callback) {
	var that = this;
	var methods = {
		mock: function() {
			callback(new Error('Not implemented'));
		},
		couchbase: function() {
			callback(new Error('Not implemented'));
		},
		couchDB: function() {
			nanoFollow(that, since, callback);
		},
		pouchDB: function() {
			pouchFollow(that, since, callback);
		},
		couchbaseSyncGateway: function() {
			nanoFollow(that, since, callback);
		}
	};
	methods[this.couchlike.config.type]();
};

function nanoUnfollow(feed, callback) {
	if (feed) { feed.stop('stop'); }
	if (callback) { callback(); }
}

function pouchUnfollow(feed, callback) {
	if (feed) { feed.cancel(); }
	if (callback) { callback(); }
}

/**
 * @desc TODO
 * @param {} feed
 * @param {UnfollowCallback} callback
 * @example
 * TODO
 */
CouchlikeChanges.prototype.unfollow = function(feed, callback) {
	var methods = {
		mock: function() {
			callback(new Error('Not implemented'));
		},
		couchbase: function() {
			callback(new Error('Not implemented'));
		},
		couchDB: function() {
			nanoUnfollow(feed, callback);
		},
		pouchDB: function() {
			pouchUnfollow(feed, callback);
		},
		couchbaseSyncGateway: function() {
			nanoUnfollow(feed, callback);
		}
	};
	methods[this.couchlike.config.type]();
};

exports.CouchlikeChanges = CouchlikeChanges;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="Couchlike.html">Couchlike</a></li><li><a href="CouchlikeChanges.html">CouchlikeChanges</a></li><li><a href="CouchlikeViews.html">CouchlikeViews</a></li></ul><h3>Events</h3><ul><li><a href="global.html#event:Change">Change</a></li></ul><h3>Global</h3><ul><li><a href="global.html#capability">capability</a></li><li><a href="global.html#engineType">engineType</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Wed Feb 25 2015 13:43:27 GMT+1100 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
